<% content_for :title, "Points" %>

<div class="w-full">
  <% if notice.present? %>
    <p class="py-2 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-md inline-block" id="notice"><%= notice %></p>
  <% end %>

  <div class="flex justify-between items-center mb-5">
    <h1 class="font-bold text-2xl">Punti gioco <%= current_user.owner.name || "Sconosciuto" %></h1>
  </div>


  <!-- Bottoni di scelta -->
  <div class="mb-5 flex space-x-4">
    <button data-tab="table" class="tab-button bg-blue-500 text-white px-4 py-2 rounded">Vista Tabellare</button>
    <button data-tab="cards" class="tab-button bg-gray-200 text-gray-800 px-4 py-2 rounded">Vista Card</button>
  </div>

  <!-- Somme totali -->
  <% if @points.any? %>
    <div class="mb-4">
      <div class="flex flex-wrap gap-4">
        <div class="bg-blue-50 px-4 py-2 rounded font-semibold">
          Trm Operatore: <%= @points.sum(&:tipo_ter_1) %>
        </div>
        <div class="bg-blue-50 px-4 py-2 rounded font-semibold">
          Trm SelfService: <%= @points.sum(&:tipo_ter_2) %>
        </div>
        <div class="bg-blue-50 px-4 py-2 rounded font-semibold">
          Trm SelfAdvance: <%= @points.sum(&:tipo_ter_3) %>
        </div>
        <div class="bg-blue-50 px-4 py-2 rounded font-semibold">
          Prenotatori: <%= @points.sum(&:prenotatori) %>
        </div>
      </div>
    </div>
  <% end %>

  <!-- Vista Tabellare -->
  <div id="tab-table" class="tab-content overflow-x-auto">
    <% if @points.any? %>
      <table class="min-w-full table-auto border-collapse">
        <thead class="bg-blue-100 text-gray-700 font-medium">
          <tr>
            <th class="px-4 py-2 text-left">Csmf</th>
            <th class="px-4 py-2 text-left">Comune</th>
            <th class="px-4 py-2 text-left">Trm Operatore</th>
            <th class="px-4 py-2 text-left">Trm SelfService</th>
            <th class="px-4 py-2 text-left">Trm SelfAdvance</th>
            <th class="px-4 py-2 text-left">Prenotatori</th>
          </tr>
        </thead>
        <tbody>
          <% @points.each do |point| %>
            <tr class="<%= cycle('bg-white', 'bg-gray-50') %>">
              <td class="px-4 py-2"><%= point.code %></td>
              <td class="px-4 py-2"><%= point.municipality.comune %></td>
              <td class="px-4 py-2"><%= point.tipo_ter_1 %></td>
              <td class="px-4 py-2"><%= point.tipo_ter_2 %></td>
              <td class="px-4 py-2"><%= point.tipo_ter_3 %></td>
              <td class="px-4 py-2"><%= point.prenotatori %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p class="text-center my-10">No points found.</p>
    <% end %>
  </div>

  <!-- Vista Card -->
  <div id="tab-cards" class="tab-content hidden">
    <% if @points.any? %>
      <div class="space-y-5 divide-y divide-gray-200">
        <% @points.each do |point| %>
          <div class="flex flex-col sm:flex-row justify-between items-center pb-5 sm:pb-0">
            <%= render point %>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="text-center my-10">No points found.</p>
    <% end %>
  </div>
</div>

<!-- Script per gestire il cambio vista -->
<script>
  document.querySelectorAll('.tab-button').forEach(button => {
    button.addEventListener('click', () => {
      const tab = button.getAttribute('data-tab');

      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.add('hidden');
      });

      document.getElementById(`tab-${tab}`).classList.remove('hidden');

      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('bg-blue-500', 'text-white');
        btn.classList.add('bg-gray-200', 'text-gray-800');
      });
      button.classList.remove('bg-gray-200', 'text-gray-800');
      button.classList.add('bg-blue-500', 'text-white');
    });
  });
</script>